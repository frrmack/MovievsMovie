{% extends "base/base.html" %}

    <!-- title -->
    {% block title %}
    {{ movie.name }}
    {% endblock %}
    <!-- end of title -->

    <!-- css -->
    {% block css %}
    .dl-horizontal dt {
       width: 75px;
       white-space: normal;
    } 
    .dl-horizontal dd {
       margin-left: 110px;
    }
    {% endblock %}
    <!-- end of css -->

    <!-- extrahead -->
    <!-- end of extrahead -->

    <!-- jquery -->
    {% csrf_token %}
    {% block jquery %}


    function getCookie(name) {
      var cookieValue = null;
      if (document.cookie && document.cookie != '') {
          var cookies = document.cookie.split(';');
          for (var i = 0; i < cookies.length; i++) {
              var cookie = jQuery.trim(cookies[i]);
              // Does this cookie string begin with the name we want?
              if (cookie.substring(0, name.length + 1) == (name + '=')) {
	          cookieValue =  decodeURIComponent(cookie.substring(name.length + 1));
                  break;
              }
          }
      }
      return cookieValue;
    }

    var csrftoken = getCookie('csrftoken');

    function csrfSafeMethod(method) {
    // these HTTP methods do not require CSRF protection
      return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
    }

    $.ajaxSetup({
      crossDomain: false, // obviates need for sameOrigin test
      beforeSend: function(xhr, settings) {
        if (!csrfSafeMethod(settings.type)) {
          xhr.setRequestHeader("X-CSRFToken", csrftoken);
        }
      }
    });


      <!-- at first show the stars in the db -->
      <!-- save the new rating if user changes it -->
      $('#star').raty({
        score: {{ movie.starRating }},
        click: function(score, evt) {
          $.ajax({
            type: "POST",
            url: "{% url 'save_rating' movie.id %}",
            data: {"rating": score},
            dataType: "json",
            success: function(data){
              console.log( "succesfully saved with rating " + data.rating );
            },
            error: function(msg){
              console.log( "There's an error with the server" );
              console.log( msg.responseText );
            }              
          });
        }
      });

    {% endblock %}
    <!-- end of jquery -->

    <!-- pageheader -->
    {% block pageheader %}
    <div class="container">
      <div class="page-header">
	<h1>{{ movie.name }}</h1>
	<a class="btn btn-primary btn-lg" href="#">Details on imdb</a>
      </div>
    </div>
    {% endblock %}
    <!-- end of pageheader -->


    <!-- content -->
    {% block content %}
    <div class="container">
      <div class="col-md-6 text-left">
	<dl class="dl-horizontal">

	  <dt>Title</dt>
	  <dd>{{ movie.name }}</dd>
	
	  <dt>Star Rating</dt>
	  <dd> 
	    <div id="star"></div>
	    <!--
	    <span class="stars">
	      {{ movie.unicode_star_rating}}
	    </span>
	    -->
	  </dd>
	
	  <dt>TrueSkill</dt>
	  <dd>{{ movie.seeded_true_skill}}</dd>
	  
	</dl>
      </div>
    </div>
    {% endblock %}
    <!-- end of content -->


